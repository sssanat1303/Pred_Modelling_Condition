condition.tree1 <- rpart(condition_overall_score_label~., data = WWT.yes.train)
plotcp(condition.tree1)
predict1 <- predict(condition.tree1, WWT.yes.train, type = "class")
confMatrix1 <- table(Actual = WWT.yes.train$condition_overall_score_label, Predicted = predict1)
confMatrix1
predict1 <- predict(condition.tree1, WWT.yes.test, type = "class")
confMatrix1 <- table(Actual = WWT.yes.test$condition_overall_score_label, Predicted = predict1)
confMatrix1
sum(diag(confMatrix1)) / nrow(WWT.yes.train)
sum(diag(confMatrix1)) / nrow(WWT.yes.test)
plot(condition.tree1, margin = 0.2)
text(condition.tree1, pretty = 2)
predict1 <- predict(condition.tree1, WWT.no, type = "class")
confMatrix1 <- table(Actual = WWT.no$condition_overall_score_label, Predicted = predict1)
confMatrix1
sum(diag(confMatrix1)) / nrow(WWT.no)
plot(condition.tree1, margin = 0.2)
text(condition.tree1, pretty = 2)
printcp(condition.tree1)
install.packages(ranger)
install.packages("ranger")
rf_model <- ranger(condition_overall_score_label ~ ., data = WWT.yes.train, trees = 500, mtry = 2)
library(ranger)
rf_model <- ranger(condition_overall_score_label ~ ., data = WWT.yes.train, trees = 500, mtry = 2)
pred <- predict(rf_model, WWT.yes.test)
confMatrix2 <- table(Predicted = pred, Actual = WWT.yes.test$condition_overall_score_label)
rf_model <- ranger(condition_overall_score_label ~ ., data = WWT.yes.train, trees = 500, mtry = 2)
pred <- predict(rf_model, WWT.yes.test, type = "class")
rf_model <- ranger(condition_overall_score_label ~ ., data = WWT.yes.train, trees = 500, mtry = 2)
pred <- predict(rf_model, WWT.yes.test, type = "response")
confMatrix2 <- table(Predicted = pred, Actual = WWT.yes.test$condition_overall_score_label)
View(rf_model)
rf_model <- ranger(condition_overall_score_label ~ ., data = WWT.yes.train, trees = 500, mtry = 2)
predict2 <- predict(rf_model, WWT.yes.test, type = "class")
rf_model <- ranger(condition_overall_score_label ~ ., data = WWT.yes.train, trees = 500, mtry = 2)
predict2 <- predict(rf_model, WWT.yes.test, type = "response")
confMatrix2 <- table(Actual = WWT.yes.test$condition_overall_score_label, Predicted = predict2)
View(predict2)
rf_model <- ranger(condition_overall_score_label ~ ., data = WWT.yes.train, trees = 500, mtry = 2)
predict2 <- predict(rf_model, WWT.yes.test, type = "response")
confMatrix2 <- table(Actual = WWT.yes.test$condition_overall_score_label, Predicted = predict2)
?ranger
rf_model <- ranger(condition_overall_score_label ~ ., data = WWT.yes.train, trees = 500, mtry = 2)
predict2 <- predict(rf_model, WWT.no, type = "class")
rf_model <- ranger(condition_overall_score_label ~ ., data = WWT.yes.train, trees = 500, mtry = 2)
predict2 <- predict(rf_model, WWT.no, type = "class")
library(ggplot2)
library(tidyverse)
library(readxl)
library(lubridate)
library(corrplot)
library(naniar)
WWT_prior <- read_xlsx("C:/Users/SSabharwal/OneDrive - Watercare Services Limited/Pred_Modelling_Condition/WWT_prior/WWT_prioritisation_final.xlsx")
# Getting rid of useless columns
WWT_prior <- WWT_prior %>% select(-GIS_ID)
WWT_prior <- WWT_prior %>% select(-OBJECTID)
WWT_prior <- WWT_prior %>% select(-WSL_OBJECTID)
WWT_prior <- WWT_prior %>% select(-EQUIP_ID)
WWT_prior <- WWT_prior %>% select(-COMPKEY)
WWT_prior <- WWT_prior %>% select(-FAC_CODE)
WWT_prior <- WWT_prior %>% select(-FAC_DESC)
WWT_prior <- WWT_prior %>% select(-PROCESS)
WWT_prior <- WWT_prior %>% select(-GRP)
WWT_prior <- WWT_prior %>% select(-POSITION)
WWT_prior <- WWT_prior %>% select(-STATUS)
WWT_prior <- WWT_prior %>% select(-LINING)
WWT_prior <- WWT_prior %>% select(-US_INV)
WWT_prior <- WWT_prior %>% select(-DS_INV)
WWT_prior <- WWT_prior %>% select(-ACCURACY)
WWT_prior <- WWT_prior %>% select(-TYPE)
WWT_prior <- WWT_prior %>% select(-SERVICE)
WWT_prior <- WWT_prior %>% select(-DATASOURCE)
WWT_prior <- WWT_prior %>% select(-SUBTYPE)
WWT_prior <- WWT_prior %>% select(-FLOWDIR)
WWT_prior <- WWT_prior %>% select(-FLOWDIRACC)
WWT_prior <- WWT_prior %>% select(-HACOMPKEY)
WWT_prior <- WWT_prior %>% select(-R_STAT)
WWT_prior <- WWT_prior %>% select(-R_MAT)
WWT_prior <- WWT_prior %>% select(-R_DIA)
WWT_prior <- WWT_prior %>% select(-R_INST)
WWT_prior <- WWT_prior %>% select(-AQ_TYPE)
WWT_prior <- WWT_prior %>% select(-USE_AREA)
WWT_prior <- WWT_prior %>% select(-HAUNITTYPE)
WWT_prior <- WWT_prior %>% select(-USE_AREAID)
WWT_prior <- WWT_prior %>% select(-R_OWN)
WWT_prior <- WWT_prior %>% select(-OWN)
WWT_prior <- WWT_prior %>% select(-PARLINENO)
WWT_prior <- WWT_prior %>% select(-F_IwiAOI)
WWT_prior <- WWT_prior %>% select(-`New action`)
# Need to fix data types for certain columns/Need to fix and normalise some entries
WWT_prior <- WWT_prior %>%
mutate(across(where(is.character), as.factor))
WWT_prior$condition_CCTV_score <- as.numeric(WWT_prior$condition_CCTV_score)
WWT_prior$condition_overall_score_label <- as.factor(WWT_prior$condition_overall_score_label)
levels(WWT_prior$condition_CCTV_source) <- c(levels(WWT_prior$condition_CCTV_source), "None")
WWT_prior$condition_CCTV_source[is.na(WWT_prior$condition_CCTV_source)] <- "None"
WWT_prior$condition_CCTV_date <- as.factor(WWT_prior$condition_CCTV_date)
levels(WWT_prior$condition_CCTV_date) <- c(levels(WWT_prior$condition_CCTV_date), "None")
WWT_prior$condition_CCTV_date[is.na(WWT_prior$condition_CCTV_date)] <- "None"
WWT_prior$condition_CCTV_score <- as.factor(WWT_prior$condition_CCTV_score)
levels(WWT_prior$condition_CCTV_score) <- c(levels(WWT_prior$condition_CCTV_score), "None")
WWT_prior$condition_CCTV_score[is.na(WWT_prior$condition_CCTV_score)] <- "None"
WWT_prior$INSTALLED <- format(WWT_prior$INSTALLED, "%Y")
WWT_prior$INSTALLED <- as.numeric(WWT_prior$INSTALLED)
# Creating modelling data set and analysis data set
WWT.analysis <- WWT_prior
WWT.analysis <- WWT.analysis %>% select(-SHAPE_Length)
WWT.modelling <- WWT_prior
WWT.modelling <- WWT.modelling %>% select(-condition_overall_score)
WWT.modelling <- WWT.modelling %>% select(-criticality_overall_score)
WWT.modelling <- WWT.modelling %>% select(-criticality_overall_score_label)
WWT.modelling <- WWT.modelling %>% select(-criticality_operational_score)
WWT.modelling <- WWT.modelling %>% select(-criticality_pipe_type_score)
WWT.modelling <- WWT.modelling %>% select(-criticality_people_impacts_score)
WWT.modelling <- WWT.modelling %>% select(-criticality_people_impacts_dataset_s_)
WWT.modelling <- WWT.modelling %>% select(-criticality_environmental_impacts_score)
WWT.modelling <- WWT.modelling %>% select(-criticality_environmental_impacts_dataset_s_)
WWT.modelling <- WWT.modelling %>% select(-criticality_infiltration_score)
WWT.modelling <- WWT.modelling %>% select(-criticality_impact_of_failure_score)
WWT.modelling <- WWT.modelling %>% select(-criticality_flow_ratio)
WWT.modelling <- WWT.modelling %>% select(-criticality_confidence_scenario)
WWT.modelling <- WWT.modelling %>% select(-condition_confidence_scenario)
WWT.modelling <- WWT.modelling %>% select(-`Risk-score`)
knitr::opts_chunk$set(message = FALSE)
library(ggplot2)
library(tidyverse)
library(readxl)
library(lubridate)
library(corrplot)
library(naniar)
library(keras)
library(glmnet)
library(xgboost)
library(finalfit)
library(rpart)
library(MASS)
library(ranger)
myfit <- function(train_df, test_df, a = 0){
train_X <- as.matrix(train_df %>% dplyr::select(-Y))
train_y <- train_df$Y
test_X <- as.matrix(test_df %>% dplyr::select(-Y))
test-y <- test_df$Y
cv.fit <- glmnet(train_X, train_y, alpha = a, lambda = lambdas)
plot(cv.fit)
opt.1 <- cv.fit$lambda.min
opt.fit <- cv.fit$glmnet.fit
bets <- as.matrix(coef(opt.fit, s = cv.fit$lambda.min))
n_non0_betas <- sum(betas!=0)
pred_y <- predict(opt.fit, s = opt.1, newx = test_X)
mse <- mean((test_y - pred_y)^2)
return(list(alpha = a, mse = mse, opt.lambda = opt.1,
n_non0_betas = n_non0_betas))
}
allyhat <- function(xtrain, ytrain, xtest, lambdas, nvmax) {
n <- nrow(xtrain)
yhat <- matrix(nrow=nrow(xtest), ncol=length(lambdas))
search <-  regsubsets(xtrain, ytrain, nvmax, method = "back")
summ <- summary(search)
for(i in 1:length(lambdas)) {
penMSE <- n*log(summ$rss) + lambdas[i]*(1:nvmax)
best <- which.min(penMSE)
betahat <- coef(search, best)
xinmodel <- cbind(1, xtest)[,summ$which[best, ]]
yhat[, i] <- xinmodel%*%betahat
}
yhat
}
WWT.modelling <- WWT.modelling %>%
select(condition_overall_score_label, everything())
WWT.modelling <- WWT.modelling[c("condition_overall_score_label", setdiff(names(WWT.modelling), "condition_overall_score_label"))]
View(WWT.modelling)
WWT.yes <- WWT.modelling %>% filter(condition_CCTV_app_availability == "yes")
WWT.no <- WWT.modelling %>% filter(condition_CCTV_app_availability == "no")
missing_plot(WWT.yes)
missing_plot(WWT.no)
View(WWT.modelling)
WWT.yes <- WWT.yes[, -9]
WWT.no <- WWT.no[, -9]
summary(WWT.modelling$condition_overall_score_label)
summary(WWT.yes$condition_overall_score_label)
summary(WWT.no$condition_overall_score_label)
set.seed(123)
rows_to_move <- which(WWT.no$condition_overall_score_label == "5")
num_to_select <- min(10, length(rows_to_move))
selected_rows <- sample(rows_to_move, num_to_select)
WWT.yes <- WWT.yes %>% rbind(WWT.no[selected_rows, ])
WWT.no <- WWT.no[-selected_rows,]
summary(WWT.yes$condition_overall_score_label)
summary(WWT.no$condition_overall_score_label)
set.seed(749)
sample.index <- sample(1:nrow(WWT.yes), size = 0.8 * nrow(WWT.yes))
WWT.yes.train <- WWT.yes[sample.index, ]
WWT.yes.test <- WWT.yes[-sample.index, ]
condition.tree1 <- rpart(condition_overall_score_label~., data = WWT.yes.train)
plotcp(condition.tree1)
predict1 <- predict(condition.tree1, WWT.yes.test, type = "class")
confMatrix1 <- table(Actual = WWT.yes.test$condition_overall_score_label, Predicted = predict1)
confMatrix1
sum(diag(confMatrix1)) / nrow(WWT.yes.test)
plot(condition.tree1, margin = 0.02)
text(condition.tree1, pretty = 2)
printcp(condition.tree1)
condition.tree2 <- rpart(condition_overall_score_label~., data = WWT.yes.train, cp =0.028751)
plotcp(condition.tree2)
predict2 <- predict(condition.tree2, WWT.yes.test, type = "class")
confMatrix2 <- table(Actual = WWT.yes.test$condition_overall_score_label, Predicted = predict2)
confMatrix2
sum(diag(confMatrix2)) / nrow(WWT.yes.test)
plot(condition.tree2)
predict3 <- predict(condition.tree2, WWT.no, type = "class")
confMatrix3 <- table(Actual = WWT.no$condition_overall_score_label, Predicted = predict3)
confMatrix3
sum(diag(confMatrix3)) / nrow(WWT.no)
rf_model <- ranger(condition_overall_score_label ~ ., data = WWT.yes.train, trees = 10000, mtry = 5)
predict4 <- predict(rf_model, WWT.yes.test)$predictions
confMatrix4 <- table(Actual = WWT.yes.test$condition_overall_score_label, Predicted = predict4)
confMatrix4
sum(diag(confMatrix4)) / nrow(WWT.yes.test)
predict5 <- predict(rf_model, WWT.no)$predictions
confMatrix5 <- table(Actual = WWT.no$condition_overall_score_label, Predicted = predict5)
confMatrix5
sum(diag(confMatrix5)) / nrow(WWT.no)
View(WWT.no)
# Convert data frames to matricies and make data and label sets
WWT.yes.train.matrix <- as.matrix(WWT.yes.train[, -11])
WWT.yes.train.label <- WWT.yes.train$condition_overall_score_label
WWT.yes.test.matrix <- as.matrix(WWT.yes.test[,-11])
WWT.yes.test.label <- WWT.yes.test$condition_overall_score_label
WWT.no.matrix <- as.matrix(WWT.no[,-11])
WWT.no.label <- WWT.no$condition_overall_score_label
View(WWT.yes.test.matrix)
View(WWT.yes.test)
View(WWT.yes.test.matrix)
View(WWT.yes.train)
View(WWT.no.matrix)
library(ggplot2)
library(tidyverse)
library(readxl)
library(lubridate)
library(corrplot)
library(naniar)
WWT_prior <- read_xlsx("C:/Users/SSabharwal/OneDrive - Watercare Services Limited/Pred_Modelling_Condition/WWT_prior/WWT_prioritisation_final.xlsx")
# Getting rid of useless columns
WWT_prior <- WWT_prior %>% select(-GIS_ID)
WWT_prior <- WWT_prior %>% select(-OBJECTID)
WWT_prior <- WWT_prior %>% select(-WSL_OBJECTID)
WWT_prior <- WWT_prior %>% select(-EQUIP_ID)
WWT_prior <- WWT_prior %>% select(-COMPKEY)
WWT_prior <- WWT_prior %>% select(-FAC_CODE)
WWT_prior <- WWT_prior %>% select(-FAC_DESC)
WWT_prior <- WWT_prior %>% select(-PROCESS)
WWT_prior <- WWT_prior %>% select(-GRP)
WWT_prior <- WWT_prior %>% select(-POSITION)
WWT_prior <- WWT_prior %>% select(-STATUS)
WWT_prior <- WWT_prior %>% select(-LINING)
WWT_prior <- WWT_prior %>% select(-US_INV)
WWT_prior <- WWT_prior %>% select(-DS_INV)
WWT_prior <- WWT_prior %>% select(-ACCURACY)
WWT_prior <- WWT_prior %>% select(-TYPE)
WWT_prior <- WWT_prior %>% select(-SERVICE)
WWT_prior <- WWT_prior %>% select(-DATASOURCE)
WWT_prior <- WWT_prior %>% select(-SUBTYPE)
WWT_prior <- WWT_prior %>% select(-FLOWDIR)
WWT_prior <- WWT_prior %>% select(-FLOWDIRACC)
WWT_prior <- WWT_prior %>% select(-HACOMPKEY)
WWT_prior <- WWT_prior %>% select(-R_STAT)
WWT_prior <- WWT_prior %>% select(-R_MAT)
WWT_prior <- WWT_prior %>% select(-R_DIA)
WWT_prior <- WWT_prior %>% select(-R_INST)
WWT_prior <- WWT_prior %>% select(-AQ_TYPE)
WWT_prior <- WWT_prior %>% select(-USE_AREA)
WWT_prior <- WWT_prior %>% select(-HAUNITTYPE)
WWT_prior <- WWT_prior %>% select(-USE_AREAID)
WWT_prior <- WWT_prior %>% select(-R_OWN)
WWT_prior <- WWT_prior %>% select(-OWN)
WWT_prior <- WWT_prior %>% select(-PARLINENO)
WWT_prior <- WWT_prior %>% select(-F_IwiAOI)
WWT_prior <- WWT_prior %>% select(-`New action`)
# Need to fix data types for certain columns/Need to fix and normalise some entries
WWT_prior <- WWT_prior %>%
mutate(across(where(is.character), as.factor))
WWT_prior$condition_CCTV_score <- as.numeric(WWT_prior$condition_CCTV_score)
WWT_prior$condition_overall_score_label <- as.factor(WWT_prior$condition_overall_score_label)
levels(WWT_prior$condition_CCTV_source) <- c(levels(WWT_prior$condition_CCTV_source), "None")
WWT_prior$condition_CCTV_source[is.na(WWT_prior$condition_CCTV_source)] <- "None"
WWT_prior$condition_CCTV_date <- as.factor(WWT_prior$condition_CCTV_date)
levels(WWT_prior$condition_CCTV_date) <- c(levels(WWT_prior$condition_CCTV_date), "None")
WWT_prior$condition_CCTV_date[is.na(WWT_prior$condition_CCTV_date)] <- "None"
WWT_prior$condition_CCTV_score <- as.factor(WWT_prior$condition_CCTV_score)
levels(WWT_prior$condition_CCTV_score) <- c(levels(WWT_prior$condition_CCTV_score), "None")
WWT_prior$condition_CCTV_score[is.na(WWT_prior$condition_CCTV_score)] <- "None"
WWT_prior$INSTALLED <- format(WWT_prior$INSTALLED, "%Y")
WWT_prior$INSTALLED <- as.numeric(WWT_prior$INSTALLED)
# Creating modelling data set and analysis data set
WWT.analysis <- WWT_prior
WWT.analysis <- WWT.analysis %>% select(-SHAPE_Length)
WWT.modelling <- WWT_prior
WWT.modelling <- WWT.modelling %>% select(-condition_overall_score)
WWT.modelling <- WWT.modelling %>% select(-criticality_overall_score)
WWT.modelling <- WWT.modelling %>% select(-criticality_overall_score_label)
WWT.modelling <- WWT.modelling %>% select(-criticality_operational_score)
WWT.modelling <- WWT.modelling %>% select(-criticality_pipe_type_score)
WWT.modelling <- WWT.modelling %>% select(-criticality_people_impacts_score)
WWT.modelling <- WWT.modelling %>% select(-criticality_people_impacts_dataset_s_)
WWT.modelling <- WWT.modelling %>% select(-criticality_environmental_impacts_score)
WWT.modelling <- WWT.modelling %>% select(-criticality_environmental_impacts_dataset_s_)
WWT.modelling <- WWT.modelling %>% select(-criticality_infiltration_score)
WWT.modelling <- WWT.modelling %>% select(-criticality_impact_of_failure_score)
WWT.modelling <- WWT.modelling %>% select(-criticality_flow_ratio)
WWT.modelling <- WWT.modelling %>% select(-criticality_confidence_scenario)
WWT.modelling <- WWT.modelling %>% select(-condition_confidence_scenario)
WWT.modelling <- WWT.modelling %>% select(-`Risk-score`)
knitr::opts_chunk$set(message = FALSE)
library(ggplot2)
library(tidyverse)
library(readxl)
library(lubridate)
library(corrplot)
library(naniar)
library(keras)
library(glmnet)
library(xgboost)
library(finalfit)
library(rpart)
library(MASS)
library(ranger)
WWT.modelling <- WWT.modelling[c("condition_overall_score_label", setdiff(names(WWT.modelling), "condition_overall_score_label"))]
WWT.yes <- WWT.modelling %>% filter(condition_CCTV_app_availability == "yes")
WWT.no <- WWT.modelling %>% filter(condition_CCTV_app_availability == "no")
missing_plot(WWT.yes)
missing_plot(WWT.no)
WWT.yes <- WWT.yes[, -9]
WWT.no <- WWT.no[, -9]
summary(WWT.modelling$condition_overall_score_label)
summary(WWT.yes$condition_overall_score_label)
summary(WWT.no$condition_overall_score_label)
set.seed(123)
rows_to_move <- which(WWT.no$condition_overall_score_label == "5")
num_to_select <- min(10, length(rows_to_move))
selected_rows <- sample(rows_to_move, num_to_select)
WWT.yes <- WWT.yes %>% rbind(WWT.no[selected_rows, ])
WWT.no <- WWT.no[-selected_rows,]
summary(WWT.yes$condition_overall_score_label)
summary(WWT.no$condition_overall_score_label)
# Convert data frames to matricies and make data and label sets
WWT.yes.train.matrix <- as.matrix(WWT.yes.train[, -1])
set.seed(749)
sample.index <- sample(1:nrow(WWT.yes), size = 0.8 * nrow(WWT.yes))
WWT.yes.train <- WWT.yes[sample.index, ]
WWT.yes.test <- WWT.yes[-sample.index, ]
# Convert data frames to matricies and make data and label sets
WWT.yes.train.matrix <- as.matrix(WWT.yes.train[, -1])
WWT.yes.train.label <- WWT.yes.train$condition_overall_score_label
WWT.yes.test.matrix <- as.matrix(WWT.yes.test[,-1])
WWT.yes.test.label <- WWT.yes.test$condition_overall_score_label
WWT.no.matrix <- as.matrix(WWT.no[,-1])
WWT.no.label <- WWT.no$condition_overall_score_label
View(WWT.yes.test.matrix)
boosted.conditiontree1 <- xgboost(data = WWT.yes.train.matrix, label = WWT.yes.train.label, max_depth = 4, eta = 1, nthreads = 2, nrounds = 50, num_classes = 5, objective = "multi:softprob", verbose = 1 )
boosted.conditiontree1 <- xgboost(data = WWT.yes.train.matrix, label = WWT.yes.train.label, max_depth = 4, eta = 1, nthreads = 2, nrounds = 50, num_class = 5, objective = "multi:softprob", verbose = 1 )
# Convert data frames to matricies and make data and label sets
WWT.yes.train.matrix <- model.matrix(WWT.yes.train[, -1])
View(WWT.yes.test.matrix)
library(ggplot2)
library(tidyverse)
library(readxl)
library(lubridate)
library(corrplot)
library(naniar)
WWT_prior <- read_xlsx("C:/Users/SSabharwal/OneDrive - Watercare Services Limited/Pred_Modelling_Condition/WWT_prior/WWT_prioritisation_final.xlsx")
# Getting rid of useless columns
WWT_prior <- WWT_prior %>% select(-GIS_ID)
library(ggplot2)
library(tidyverse)
library(readxl)
library(lubridate)
library(corrplot)
library(naniar)
WWT_prior <- read_xlsx("C:/Users/SSabharwal/OneDrive - Watercare Services Limited/Pred_Modelling_Condition/WWT_prior/WWT_prioritisation_final.xlsx")
# Getting rid of useless columns
WWT_prior <- WWT_prior %>% select(-GIS_ID)
WWL_prior <- read_xlsx("C:/Users/SSabharwal/OneDrive - Watercare Services Limited/Pred_Modelling_Condition/WWL_prior/WW_local_prioritisation_final.xlsx")
library(ggplot2)
library(tidyverse)
library(readxl)
library(lubridate)
library(corrplot)
library(naniar)
WWL_prior <- read_xlsx("C:/Users/SSabharwal/OneDrive - Watercare Services Limited/Pred_Modelling_Condition/WWL_prior/WW_local_prioritisation_final.xlsx")
setwd("C:/Users/SSabharwal/OneDrive - Watercare Services Limited/Pred_Modelling_Condition/WWL_prior")
library(ggplot2)
library(tidyverse)
library(readxl)
library(lubridate)
library(corrplot)
library(naniar)
WWL_prior <- read_xlsx("C:/Users/SSabharwal/OneDrive - Watercare Services Limited/Pred_Modelling_Condition/WWL_prior/WW_local_prioritisation_final.xlsx")
# Getting rid of useless columns
WWL_prior <- WWL_prior %>% select(-OBJECTID)
WWL_prior <- WWL_prior %>% select(-GIS_ID)
WWL_prior <- WWL_prior %>% select(-COMPKEY)
WWL_prior <- WWL_prior %>% select(-PROCESS)
WWL_prior <- WWL_prior %>% select(-TYPE)
WWL_prior <- WWL_prior %>% select(-SERVICE)
WWL_prior <- WWL_prior %>% select(-HACOMPKEY)
WWL_prior <- WWL_prior %>% select(-constructability_overall_score_label)
WWL_prior <- WWL_prior %>% select(-constructability_location_scoring)
WWL_prior <- WWL_prior %>% select(-constructability_location_scoring_dataset_s_)
WWL_prior <- WWL_prior %>% select(-constructability_traffic_scoring)
WWL_prior <- WWL_prior %>% select(-constructability_traffic_scoring_dataset_s_)
WWL_prior <- WWL_prior %>% select(-constructability_stakeholder_scoring)
WWL_prior <- WWL_prior %>% select(-constructability_depth_score)
WWL_prior <- WWL_prior %>% select(-constructability_depth__m_)
WWL_prior <- WWL_prior %>% select(-constructability_environmental_scoring)
WWL_prior <- WWL_prior %>% select(-constructability_environmental_scoring_dataset_s_)
WWL_prior <- WWL_prior %>% select(-constructability_Confidence_Scenario)
WWL_prior <- WWL_prior %>% select(-constructability_stakeholder_scoring_dataset_s_)
WWL_prior <- WWL_prior %>% select(-`Plan for`)
WWL_prior <- WWL_prior %>% select(-`Age...63`)
WWL_prior <- WWL_prior %>% select(-`RUL(remaining useful life)`)
WWL_prior <- WWL_prior %>% select(-`Age...65`)
WWL_prior <- WWL_prior %>% select(-`...66`)
WWL_prior <- WWL_prior %>% select(-`Adjusted estimated life`)
WWL_prior <- WWL_prior %>% select(-`Cost estimate ($)`)
WWL_prior <- WWL_prior %>% select(-`MATERIAL...67`)
WWL_prior <- WWL_prior %>% select(-`...69`)
WWL_prior <- WWL_prior %>% select(-`Cost per year`)
WWL_prior <- WWL_prior %>% select(-`...71`)
WWL_prior <- WWL_prior %>% select(-`...72`)
WWL_prior <- WWL_prior %>% select(-criticality_overall_score_label)
WWL_prior <- WWL_prior %>% select(-`cumulative length`)
#Fixing datatypes and restructuring columns/also dealing
WWL_prior$INSTALLED <- format(WWL_prior$INSTALLED, "%Y")
WWL_prior$INSTALLED <- as.numeric(WWL_prior$INSTALLED)
WWL_prior <- WWL_prior %>% rename("MATERIAL" = `MATERIAL...5`)
WWL_prior$Depth <- as.numeric(WWL_prior$Depth)
WWL_prior$criticality_groundlevel <- as.numeric(WWL_prior$criticality_groundlevel)
WWL_prior$condition_overall_score_label <- as.factor(WWL_prior$condition_overall_score_label)
WWL_prior$condition_CCTV_INSP_Date <- format(WWL_prior$condition_CCTV_INSP_Date, "%Y")
WWL_prior$condition_CCTV_INSP_Date <- as.numeric(WWL_prior$condition_CCTV_INSP_Date)
WWL_prior$condition_last_recorded_overflow <- as.numeric(substr(WWL_prior$condition_last_recorded_overflow, 1, 4))
WWL_prior <- WWL_prior %>% mutate_if(is.character, as.factor)
# Making modelling and analysis datasets
WWL.analysis <- WWL_prior
WWL_prior <- WWL_prior %>% select(-criticality_overall_score)
WWL_prior <- WWL_prior %>% select(-criticality_hydro_basement_score)
WWL_prior <- WWL_prior %>% select(-criticality_groundlevel)
WWL_prior <- WWL_prior %>% select(-criticality_impact_on_people_score)
WWL_prior <- WWL_prior %>% select(-criticality_people_impacts_dataset_s_)
WWL_prior <- WWL_prior %>% select(-criticality_upstream_connections_score)
WWL_prior <- WWL_prior %>% select(-criticality_impact_on_environment_score)
WWL_prior <- WWL_prior %>% select(-criticality_environmental_impacts_dataset_s_)
WWL_prior <- WWL_prior %>% select(-criticality_engineered_overflow_health_enviro)
WWL_prior <- WWL_prior %>% select(-criticality_engineered_overflow_manholes)
WWL_prior <- WWL_prior %>% select(-criticality_pipe_importance_level)
WWL_prior <- WWL_prior %>% select(-criticality_Confidence_Scenario)
WWL_prior <- WWL_prior %>% select(-condition_CCTV_provider)
WWL_prior <- WWL_prior %>% select(-condition_flushing_dataset)
WWL.modelling <- WWL_prior
write.csv(WWL.modelling, "WWL.modelling.csv", row.names = FALSE)
write.csv(WWL.analysis,"WWL.analysis.csv", row.names = FALSE)
library(ggplot2)
library(tidyverse)
library(readxl)
library(lubridate)
library(corrplot)
library(naniar)
library(keras)
library(glmnet)
library(xgboost)
library(finalfit)
library(rpart)
library(MASS)
library(ranger)
WWL.modelling <- read_csv("WWL.modelling.csv")
WWL.modelling <- WWL.modelling %>% mutate_if(is.character, as.factor)
WWL.modelling$condition_overall_score_label <- as.factor(WWL.modelling$condition_overall_score_label)
str(WWL.modelling)
WWL.modelling <- WWL.modelling %>% select(-condition_overall_score_label)
View(WWL.modelling)
WWL.modelling <- WWL.modelling[,-7]
head(WWL.modelling)
WWL.modelling <- WWL.modelling[c("condition_overall_score_label", setdiff(names(WWL.modelling), "condition_overall_score_label"))]
missing_plot(WWL.modelling)
summary(WWL.modelling$condition_CCTV_INSP_Date)
WWL.modelling$Depth[is.na(WWL.modelling$Depth)] <- 0
WWL.modelling <- WWL.modelling %>% select(-condition_CCTV_INSP_Date)
library(dplyr)
WWL.modelling$Depth[is.na(WWL.modelling$Depth)] <- 0
WWL.modelling <- WWL.modelling %>% select(-condition_CCTV_INSP_Date)
library(ggplot2)
library(tidyverse)
library(readxl)
library(lubridate)
library(corrplot)
library(naniar)
library(keras)
library(glmnet)
library(xgboost)
library(finalfit)
library(rpart)
library(MASS)
library(ranger)
WWL.modelling <- read_csv("WWL.modelling.csv")
WWL.modelling <- WWL.modelling %>% mutate_if(is.character, as.factor)
WWL.modelling$condition_overall_score_label <- as.factor(WWL.modelling$condition_overall_score_label)
head(WWL.modelling)
WWL.modelling <- WWL.modelling[c("condition_overall_score_label", setdiff(names(WWL.modelling), "condition_overall_score_label"))]
missing_plot(WWL.modelling)
library(dplyr)
WWL.modelling$Depth[is.na(WWL.modelling$Depth)] <- 0
WWL.modelling <- WWL.modelling %>% select(-condition_CCTV_INSP_Date)
